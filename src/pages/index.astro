---
import { Image } from 'astro:assets'

import { Quote } from 'astro-pure/advanced'
import PostPreview from '@/components/custom/PostPreview.astro'
import { getBlogCollection, sortMDByDate } from 'astro-pure/server'
import { getCollection } from 'astro:content'
import { Button, Card, Icon, Label } from 'astro-pure/user'
import PageLayout from '@/layouts/BaseLayout.astro'
import ProjectCard from '@/components/home/ProjectCard.astro'
import Section from '@/components/home/Section.astro'
import SkillLayout from '@/components/home/SkillLayout.astro'

import avatar from '@/assets/avatar.png'
import config from '@/site-config'

const languages = ['Html', 'JavaScript', 'CSS', 'Shell']
const frontend = ['TypeScript', 'Vite', 'Webpack', 'Astro']
const backend = ['Vercel', 'Waline']

const MAX_POSTS = 6
const allPosts = await getBlogCollection()
const allPostsByDate = sortMDByDate(allPosts).slice(0, MAX_POSTS)
const allActivities = await getCollection('activities')
const nonDraftActivities = allActivities.filter(activity => !activity.data.draft)
const recentActivities = nonDraftActivities
  .sort((a, b) => {
    // order 升序；同 order 时按 publishDate 降序
    const orderDiff = (a.data.order ?? 999) - (b.data.order ?? 999)
    if (orderDiff !== 0) return orderDiff
    const aDate = new Date(a.data.publishDate).getTime()
    const bDate = new Date(b.data.publishDate).getTime()
    return bDate - aDate
  })
  .slice(0, 3)
---

<PageLayout meta={{ title: 'Home' }} highlightColor='#5B8BB3'>
  <style>
    .masonry-container {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }
    .masonry-column {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }
    @media (min-width: 768px) {
      .masonry-container {
        flex-direction: row;
        gap: 1.5rem;
      }
      .masonry-column {
        flex: 1;
      }
    }
    /* 移动端重新排序 */
    @media (max-width: 767px) {
      .masonry-container {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }
      .masonry-column {
        display: contents;
      }
      .masonry-item {
        order: var(--order);
      }
    }
  </style>
  
  <main class='flex w-full flex-col items-center'>
    <section class='animate mb-10 flex flex-col items-center gap-y-7' id='content-header'>
      <div class='avatar-glass h-28 w-auto p-1'>
        <Image
          src={avatar}
          alt='profile'
          class='h-full w-auto rounded-lg'
          loading='eager'
        />
      </div>

      <div class='flex flex-col items-center gap-y-4'>
        <h1 class='animated-gradient-title text-3xl' data-text={config.author}>{config.author}</h1>
        <div class='flex flex-wrap justify-center gap-x-7 gap-y-3'>
          <Label title='Shanghai, China'>
            <Icon name='location' class='size-5' slot='icon' />
          </Label>
          <Label
            title='GitHub'
            as='a'
            href='https://github.com/VapourX-ScaleLab'
            target='_blank'
          >
            <Icon name='github' class='size-5' slot='icon' />
          </Label>
        </div>
      </div>

    </section>

    <div id='content' class='animate flex flex-col gap-y-10 md:w-4/5 lg:w-5/6'>
      {/* <Section title='About'>
        <p class='text-muted-foreground'>Developer / Designer</p>
        <p class='text-muted-foreground'>
          Lorem ipsum dolor sit amet, vidit suscipit at mei. Quem denique mea id. Usu ei regione
          indoctum dissentiunt, cu meliore fuisset mei, vel quod voluptua ne. Ex dicat impedit mel,
          at eum oratio possit voluptatum.
        </p>
        <Button title='More about me' class='w-fit self-end' href='/about' style='ahead' />
      </Section> */}
      {
        allPostsByDate.length > 0 && (
          <Section title='Recent Posts'>
            <div class='masonry-container'>
              <div class='masonry-column'>
                {allPostsByDate.filter((_, index) => index % 2 === 0).map((p, colIndex) => (
                  <div class='masonry-item' style={`--order: ${colIndex * 2}`}>
                    <PostPreview post={p} detailed />
                  </div>
                ))}
              </div>
              <div class='masonry-column'>
                {allPostsByDate.filter((_, index) => index % 2 === 1).map((p, colIndex) => (
                  <div class='masonry-item' style={`--order: ${colIndex * 2 + 1}`}>
                    <PostPreview post={p} detailed />
                  </div>
                ))}
              </div>
            </div>
            <Button title='More posts' class='w-fit self-end' href='/blog' style='ahead' />
          </Section>
        )
      }

      {
        /* <Section title='Experience'>
      <Card
        heading='Lorem Ipsum'
        subheading='Sit amet consectetur'
        date='Dec 2022 - Nov 2023'
        imagePath='/src/assets/about-astro.png'
        altText='Lorem, ipsum dolor sit'
        imageClass='h-12 w-auto md:-start-16'
      >
        <ul class='ms-4 list-disc text-muted-foreground'>
          <li>
            Lorem, ipsum dolor sit amet consectetur adipisicing elit. Dolore debitis recusandae, ut
            molestiae laboriosam pariatur!

            <li>Lorem ipsum dolor sit amet consectetur adipisicing elit. Molestiae, pariatur!</li>
          </li>
        </ul>
      </Card>
      <Card
        heading='Lorem Ipsum'
        subheading='Sit amet consectetur'
        date='Dec 2022 - Nov 2023'
        imagePath='/src/assets/about-astro.png'
        altText='Lorem, ipsum dolor sit'
        imageClass='h-12 w-auto md:-start-16'
      />
    </Section> */
      }
      {/* <Section title='Education'>
        <Card
          as='a'
          heading='Lorem ipsum'
          subheading='Lorem ipsum dolor sit amet, vidit suscipit at mei.'
          date='August 2021 - July 2025'
          href='https://www.youtube.com/watch?v=dQw4w9WgXcQ'
        >
          {
            /* <ul class='ms-4 list-disc text-muted-foreground'>
          <li>
            Lorem, ipsum dolor sit amet consectetur adipisicing elit. Dolore debitis recusandae, ut
            molestiae laboriosam pariatur!
          </li>
          <li>Lorem ipsum dolor sit amet consectetur adipisicing elit. Molestiae, pariatur!</li>
        </ul> 
        </Card>
      </Section>} */
    }

      {
        allActivities.length > 0 && (
          <Section title='Recent Activities'>
            <div class='flex flex-col gap-4'>
              {recentActivities.map((activity: any) => (
                <PostPreview post={activity} detailed />
              ))}
            </div>
            <Button title='View all activities' class='w-fit self-end' href='/activities' style='ahead' />
          </Section>
        )
      }

      {/* <Section title='Certifications'>
        <Card
          as='a'
          heading='Lorem ipsum'
          subheading='Lorem ipsum dolor sit amet, vidit suscipit at mei. Quem denique mea id. Usu ei regione indoctum dissentiunt, cu meliore fuisset mei, vel quod voluptua ne. Ex dicat impedit mel, at eum oratio possit voluptatum. Dicat ceteros cu vim. Impetus fuisset ullamcorper pri cu, his posse iisque ad, aliquam honestatis usu id.'
          date='July 2024'
          href='https://www.youtube.com/watch?v=dQw4w9WgXcQ'
        />
      </Section>

      <Section title='Skills'>
        <SkillLayout title='Languages' skills={languages} />
        <SkillLayout title='Frontend' skills={frontend} />
        <SkillLayout title='Backend' skills={backend} />
      </Section> */}

      <Section title='About'>
        <p class='text-muted-foreground'>What is VapourX</p>
        <p class='text-muted-foreground'>
          VapourX 正在汇聚一群对具身智能充满热情的爱好者、专业人士和研究人员，致力于推动人类、数字人和机器人之间的自然交互，促使具身智能从研究走向现实，在产业与创新中实现无缝演进，逐步实现具身智能走入千家万户。这是一个不断上升、不断扩充的社区，Vapour代表不断蒸腾的力量，X代表无限的链接和未知的探索。
        </p>
        <Button title='More about us' class='w-fit self-end' href='/about' style='ahead' />
      </Section>
    </div>
    {/* <Quote class='mt-12' /> */}
    
    {/* Floating Action Button */}
    <div class='fixed bottom-6 right-6 z-50 group'>
      {/* Main floating button */}
      <div class='w-14 h-14 bg-primary/20 dark:bg-primary/20 rounded-full flex items-center justify-center cursor-pointer shadow-lg backdrop-blur-md transition-all duration-300 hover:scale-110 hover:shadow-xl hover:shadow-purple-500/30'>
        <svg class='w-6 h-6 text-black dark:text-white transition-transform duration-300 group-hover:rotate-45' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
          <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 4v16m8-8H4'></path>
        </svg>
      </div>
      
      {/* Floating menu */}
      <div class='absolute bottom-16 right-0 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform translate-y-2 group-hover:translate-y-0'>
        <div class='flex flex-col gap-3 items-end'>
          {/* Upload New Blog */}
          <a
            href='/admin'
            class='flex items-center gap-x-3 rounded-full bg-primary/20 text-black px-4 py-2 text-sm backdrop-blur-md transition-all duration-300 hover:bg-black hover:text-white hover:shadow-lg hover:scale-105 dark:bg-primary/20 dark:text-white dark:hover:bg-black dark:hover:text-white whitespace-nowrap'
          >
            <p class='font-medium'>Upload New Blog</p>
          </a>
          
          {/* Become a Creator */}
          <a
            href='/member-form'
            class='flex items-center gap-x-3 rounded-full border-2 border-primary/40 text-black px-3 py-2 text-sm backdrop-blur-md transition-all duration-300 hover:bg-primary/20 hover:shadow-lg hover:scale-105 dark:border-primary/20 dark:text-white dark:hover:bg-primary/20 whitespace-nowrap'
          >
            <p class='font-medium'>Become a Creator</p>
          </a>
        </div>
      </div>
    </div>
  </main>
</PageLayout>
